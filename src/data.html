<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Getting your data into Python</title>
  <meta name="description" content="# Getting your data into Python# OverviewThis chapter is about interacting with data on your computer's disk --mostly loading it into Python, but also writin...">

  <link rel="canonical" href="https://v4py.github.io//src/data.html">
  <link rel="alternate" type="application/rss+xml" title="An Introduction to Python for Linguists" href="https://v4py.github.io//feed.xml">

  <meta property="og:url"         content="https://v4py.github.io//src/data.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Getting your data into Python" />
<meta property="og:description" content="# Getting your data into Python# OverviewThis chapter is about interacting with data on your computer's disk --mostly loading it into Python, but also writin..." />
<meta property="og:image"       content="https://v4py.github.io/images/v4py_logo_wide.svg" />

<meta name="twitter:card" content="summary">


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": "https://v4py.github.io//src/data.html",
  "headline": "Getting your data into Python",
  "datePublished": "2020-04-01T21:54:14+02:00",
  "dateModified": "2020-04-01T21:54:14+02:00",
  "description": "# Getting your data into Python# OverviewThis chapter is about interacting with data on your computer's disk --mostly loading it into Python, but also writin...",
  "author": {
    "@type": "Person",
    "name": "David Luke≈°, Rudolf Rosa"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://v4py.github.io/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://v4py.github.io/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/v4py_logo.svg">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<!-- (mostly) copied from nbconvert configuration -->
<!-- https://github.com/jupyter/nbconvert/blob/master/nbconvert/templates/html/mathjax.tpl -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true },
    },
    
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML' async></script>


  <!-- DOM updating function -->
  <script src="/assets/js/page/dom-update.js"></script>

  <!-- Selectors for elements on the page -->
  <script src="/assets/js/page/documentSelectors.js"></script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js" async></script>
  <script src="/assets/js/page/anchors.js" async></script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->



  <!-- Load the auto-generating TOC (non-async otherwise the TOC won't load w/ turbolinks) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.8.1/tocbot.min.js" async></script>
  <script src="/assets/js/page/tocbot.js"></script>

  <!-- Google analytics -->
  


  <!-- Clipboard copy button -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script>

  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
<script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
function dict2param(dict) {
    params = Object.keys(dict).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(dict[k])
    });
    return params.join('&')
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return dict2param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = document.querySelectorAll("a").forEach(function(link) {
    var href = link.href;
    // If the link is an internal link...
    if (href.search("https://v4py.github.io") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['jupyterhub'] = hub;
      } else {
        // Create the REST params
        params = {'jupyterhub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + dict2param(params);
      link.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}


// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    jupyterHubUrl = rest['jupyterhub'];
    var hubType = null;
    var hubUrl = null;
    if (jupyterHubUrl !== undefined) {
      hubType = 'jupyterhub';
      hubUrl = jupyterHubUrl;
    }

    if (hubType !== null) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);

      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      var interactButtons = document.querySelectorAll("button.interact-button")
      var lastButton = interactButtons[interactButtons.length-1];
      var link = lastButton.parentElement;

      // If we've already run this, skip the link updating
      if (link.nextElementSibling !== null) {
        return;
      }

      // Update the link and add context div
      var href = link.getAttribute('href');
      if (lastButton.id === 'interact-button-binder') {
        // If binder links exist, we need to re-work them for jupyterhub
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // If localhost, assume we're working from a local Jupyter server and remove `/hub`
          first = [hubUrl, 'git-sync'].join('/')
        } else {
          first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
        }
        href = first + '?' + binder2Jupyterhub(href);
      } else {
        // If interact button isn't binderhub, assume it's jupyterhub
        // If JupyterHub links, we only need to replace the hub url
        href = href.replace("https://jupyter.korpus.cz", hubUrl);
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // Assume we're working from a local Jupyter server and remove `/hub`
          href = href.replace("/hub/user-redirect", "");
        }
      }
      link.setAttribute('href', decodeURIComponent(href));

      // Add text after interact link saying where we're launching
      hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
      link.insertAdjacentHTML('afterend', '<div class="interact-context">on ' + hubUrlNoHttp + '</div>');

      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>


  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" async></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>

  <!-- Load JS that depends on site variables -->
  <script src="/assets/js/page/copy-button.js" async></script>

  <!-- Hide cell code -->
  <script src="/assets/js/page/hide-cell.js" async></script>

  <!-- Printing the screen -->
  <!-- Include nbinteract for interactive widgets -->
<script src="https://printjs-4de6.kxcdn.com/print.min.js" async></script>
<script>
printContent = () => {
    // MathJax displays a second version of any math for assistive devices etc.
    // This prevents double-rendering in the PDF output.
    var ignoreAssistList = [];
    assistives = document.querySelectorAll('.MathJax_Display span.MJX_Assistive_MathML').forEach((element, index) => {
        var thisId = 'MathJax-assistive-' + index.toString();
        element.setAttribute('id', thisId);
        ignoreAssistList.push(thisId)
    });

    // Print the actual content object
    printJS({
        printable: 'textbook_content',
        type: 'html',
        css: "/assets/css/styles.css",
        style: "#textbook_content {padding-top: 40px};",
        scanStyles: false,
        targetStyles: ["*"],
        ignoreElements: ignoreAssistList,
        documentTitle: "An Introduction to Python for Linguists"
    })
};

initPrint = () => {
    document.querySelector('#interact-button-print').addEventListener('click', printContent)
}

initFunction(initPrint)
</script>

</head>

  <body>
    <!-- Include the ThebeLab config so it gets reloaded on each page -->
    <script type="text/x-thebe-config">{
    requestKernel: true,
    binderOptions: {
    repo: "v4py/v4py.github.io",
    ref: "master",
    },
    codeMirrorConfig: {
    theme: "abcdef",
    mode: "python"
    },
    kernelOptions: {
    kernelName: "python3",
    path: ""
    }
}
</script>

    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://v4py.github.io"><img src="/images/v4py_logo_wide.svg" class="textbook_logo" id="sidebar-logo" alt="textbook logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">An Introduction to Python for Linguists</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="https://dlukes.github.io/">
        <a class="c-sidebar__entry"
          href="https://dlukes.github.io/"
        >
          
          David Luke≈°
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="https://ufal.mff.cuni.cz/rudolf-rosa">
        <a class="c-sidebar__entry"
          href="https://ufal.mff.cuni.cz/rudolf-rosa"
        >
          
          Rudolf Rosa
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      
        <li><h2 class="c-sidebar__title">Table of contents</li>
        
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/intro">
        <a class="c-sidebar__entry"
          href="/intro.html"
        >
          
            1.
          
          Introduction
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/basics">
        <a class="c-sidebar__entry"
          href="/basics.html"
        >
          
            2.
          
          A tour of Python and NLTK
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/unicode">
        <a class="c-sidebar__entry"
          href="/unicode.html"
        >
          
            3.
          
          Text inside the computer
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/data">
        <a class="c-sidebar__entry"
          href="/data.html"
        >
          
            4.
          
          Getting your data into Python
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/rest">
        <a class="c-sidebar__entry"
          href="/rest.html"
        >
          
            5.
          
          Working with online resources
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/regex">
        <a class="c-sidebar__entry"
          href="/regex.html"
        >
          
            6.
          
          Regular expressions
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/outro">
        <a class="c-sidebar__entry"
          href="/outro.html"
        >
          
            7.
          
          Parting words
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      
        <li><h2 class="c-sidebar__title">Links</li>
        
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="https://ufal.mff.cuni.cz/">
        <a class="c-sidebar__entry"
          href="https://ufal.mff.cuni.cz/"
        >
          
          √öFAL MFF UK
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="https://korpus.cz/">
        <a class="c-sidebar__entry"
          href="https://korpus.cz/"
        >
          
          Czech National Corpus
        </a>
      </li>

      
      

      

      
      

      

      
    
  </ul>
  <p class="sidebar_footer">Sponsored by <a href="https://www.visegradfund.org/">Visegrad Fund</a> grant nr. 21820079 "Training Digital Scholars: Knowledge Exchange between V4 and Austria". Available under the terms of the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> license.</p>
</nav>

      
      <div class="c-topbar" id="top-navbar">
  <!-- We show the sidebar by default so we use .is-active -->
  <div class="c-topbar__buttons">
    <button
      id="js-sidebar-toggle"
      class="hamburger hamburger--arrowalt is-active"
    >
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="buttons">
<div class="download-buttons-dropdown">
    <button id="dropdown-button-trigger" class="interact-button"><img src="/assets/images/download-solid.svg" alt="Download" /></button>
    <div class="download-buttons">
        
        <a id="interact-button-print"><button id="interact-button-download" class="interact-button">.pdf</button></a>
    </div>
</div>


</div>

  </div>
  <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
  <aside class="sidebar__right">
    <header><h4 class="nav__title"><img src="/assets/images/list-solid.svg" alt="Search" />   On this page</h4></header>
    <nav class="onthispage">
    </nav>
  </aside>
  <a href="/search.html" class="topbar-right-button" id="search-button">
    <img src="/assets/images/search-solid.svg" alt="Search" />
  </a>
</div>

      <main class="c-textbook__page" tabindex="-1">
            <div class="c-textbook__content" id="textbook_content">
              <h1 id="getting-your-data-into-python">Getting your data into Python</h1>

<h1 id="overview">Overview</h1>

<p>This chapter is about interacting with data on your computer‚Äôs disk ‚Äì
mostly loading it into Python, but also writing it back, and storing it
for quick reloading later.</p>

<h1 id="plain-text-files">Plain text files</h1>

<p>A <strong>plain text</strong> file is a file where every single bit contributes
towards representing plain text content. What fits into the concept of
‚Äòplain text‚Äô is actually surprisingly fuzzy ‚Äì it depends on which
characters are available in the character set you‚Äôre using, and
character sets are just arbitrary human conventions. Historically,
there were computer systems that didn‚Äôt make case distinctions, so upper
vs. lower case was not something you could express using just plain
text.</p>

<p>Nowadays, Unicode is making inroads into text properties which were
previously the domain of <strong>rich text</strong>, assigning dedicated codepoints
to ùò™ùòµùò¢ùò≠ùò™ùò§ùò¥ or À¢·µò·µñ·µâ ≥À¢·∂ú ≥·∂¶·µñ·µó, which allow you, among other things, to work
around the lack of rich text capabilities in Twitter or Facebook posts
(although that‚Äôs obviously not what they were originally intended for).
But the further you go along the axis of content vs. appearance, the
more you encounter properties which are unlikely to ever make it into
plain text, like the ability to specify which particular font the text
should be displayed with.</p>

<p>```python tags=[‚Äúoutput_scroll‚Äù]
from unicodedata import name</p>

<p>for char in ‚Äúùò™ùòµùò¢ùò≠ùò™ùò§ùò¥À¢·µò·µñ·µâ ≥À¢·∂ú ≥·∂¶·µñ·µó‚Äù:
    print(char, name(char), sep=‚Äù\t‚Äù)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Plain text files can be opened with the built-in `open()` function. As
we've seen in our discussion of [Unicode](unicode), your safest bet with
a plain text file in an unknown encoding is to start by trying to open
it as `UTF-8` -- not because that will always work, but precisely
because it won't: if it's not actually `UTF-8`, you're likely to get an
error, which will tell you there's something fishy and prevent you from
corrupting your data. Also, `UTF-8` is becoming more and more prevalent,
so chances are good that file actually *is* `UTF-8`, in which case
you're golden. The `text.txt` file below, though, isn't.

```python tags=["raises-exception", "full_width", "output_scroll"]
with open("data/text.txt", encoding="utf-8") as file:
    print(file.read())
</code></pre></div></div>

<p>OK, that didn‚Äôt work. Now you can start thinking about alternatives. Do
you know anything about the language the text in the file is supposed to
be in? If it‚Äôs a Western European language, then the encoding might be
<a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-1"><code class="language-plaintext highlighter-rouge">latin1</code></a> or
<a href="https://en.wikipedia.org/wiki/Windows-1252"><code class="language-plaintext highlighter-rouge">cp1252</code></a>; if it‚Äôs Central
European, then perhaps
<a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-2"><code class="language-plaintext highlighter-rouge">latin2</code></a> or
<a href="https://en.wikipedia.org/wiki/Windows-1250"><code class="language-plaintext highlighter-rouge">cp1250</code></a> (beyond those
two regions, I‚Äôm afraid I can‚Äôt give any tips, you‚Äôll have to rely on
web search engines).</p>

<p>Let‚Äôs say we know <code class="language-plaintext highlighter-rouge">text.txt</code> is in Czech, a Central European
language. We might want to try <code class="language-plaintext highlighter-rouge">cp1250</code>, because that‚Äôs <em>still</em> (ugh)
the default encoding for text files created under the Czech version of
Windows, and that‚Äôs where the file might have come from.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.txt"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"cp1250"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<p>The tricky thing here is that everything went seemingly fine, no error
occurred. That‚Äôs because <code class="language-plaintext highlighter-rouge">cp1250</code> is an 8-bit fixed-width encoding, and
any sequence of bytes can be interpreted as a <code class="language-plaintext highlighter-rouge">cp1250</code>-encoded file ‚Äì
even if it was originally intended to be something else. If a Czech
speaker tries to read this output, some words will be off. It may be
hard to spot them, because many 8-bit encodings share a lot of the
byte‚Äìcharacter mappings, at least in the ASCII range [0; 128), but to a
smaller extent even beyond. This makes it easier to still read at least
parts of the file if you‚Äôve guessed the encoding wrong, but it also
makes it harder to realize that.</p>

<p>The 1990s were the age of many different 8-bit encodings for different
groups of languages. It sucked. Be glad you live in the age of <code class="language-plaintext highlighter-rouge">UTF-8</code>.</p>

<p>Finally, if we try <code class="language-plaintext highlighter-rouge">latin2</code>, that Czech person helpfully standing behind
you can tell you that now, the result looks alright. If you compare with
the previous attempt, you may see that there are indeed minute
differences.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.txt"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"latin2"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<p>Sometimes, you may encounter a plain text file that you know should be
in <code class="language-plaintext highlighter-rouge">UTF-8</code>, but it has become corrupted for some reason ‚Äì maybe it was
spliced together with another file in a different encoding, or maybe
some evil spirit flipped a few bits here and there. In that case, the
contents won‚Äôt look right in any one encoding, but you might still want
to at least have a glimpse at what it contains. To make Python soldier
through in spite of encountering invalid byte sequences (i.e. encoding
errors), you can specify an error handler. A preview of a few of the
more common options is given below; for a full list, refer
<a href="https://docs.python.org/3/library/codecs.html#error-handlers">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.txt"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"replace"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.txt"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"ignore"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.txt"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"backslashreplace"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<p>Incidentally, this allows us to take a peek at what a rich text file
looks like under the hood. If you open <code class="language-plaintext highlighter-rouge">text.doc</code> in a word processor,
you‚Äôll see that it has the same textual content as <code class="language-plaintext highlighter-rouge">text.txt</code>. But
opening it as plain text, we see that the file definitely contains some
more stuff besides that, and most of it can‚Äôt be interpreted as text ‚Äì
there‚Äôs a lot of those question mark replacement characters, and even
more null bytes (<code class="language-plaintext highlighter-rouge">\x00</code>, i.e. a byte consisting of all 0‚Äôs). Some of it
is metadata, e.g. who wrote the text and when, or possibly encoding
information, so that the word processor doesn‚Äôt have to take blind
guesses at which encoding the text is stored in like we just had to.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/text.doc"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"replace"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">txt</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># this is probably author metadata?
</span><span class="n">index</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"Luke≈°"</span><span class="p">)</span>
<span class="n">txt</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># and this is probably the part which corresponds to "Magda ka≈àonem" in
# our plain text file
</span><span class="n">index</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"M"</span><span class="p">)</span>
<span class="n">txt</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
</code></pre></div></div>

<h1 id="manipulating-tabular-data">Manipulating tabular data</h1>

<!-- #md tags=["popout"] -->

<p>CSVs are actually plain text files ‚Äì in their simplest form, each row
of the table is just a line of text, with columns separated by commas.
However, in order to allow the individual fields to contain commas or
newlines (which normally act as column and row separators), the CSV
standard defines fairly complicated escaping mechanisms which you don‚Äôt
want to implement yourself. So it‚Äôs generally better to rely on a
library to parse CSVs and not do it manually, unless you know for a fact
that the CSV contains none of these gotchas.</p>

<!-- #endmd -->

<p>Data often comes in tabular format ‚Äì Excel files, CSV files and the
like. The easiest and most convenient way to load this type of data into
Python and manipulate it is using the
<a href="https://pandas.pydata.org/"><code class="language-plaintext highlighter-rouge">pandas</code></a> library. While manual
modifications of individual cells will probably always be more ergonomic
in a spreadsheet editor like Excel, any kind of mass data manipulation
is what <code class="language-plaintext highlighter-rouge">pandas</code>‚Ä¶ excels at, if you‚Äôll pardon the pun. It does so in a
clean and efficient way, mostly without even breaking a sweat, and best
of all, you can always retrace your steps and check whether you‚Äôve made
a mistake at some point because you‚Äôre writing them down as Python
commands instead of clicking around in a graphical user interface. Not
to mention that this makes it trivial to apply the same series of
processing steps to similarly shaped data, once you‚Äôve figured them out.</p>

<h2 id="the-pandas-library">The <code class="language-plaintext highlighter-rouge">pandas</code> library</h2>

<p>Let‚Äôs fire up <code class="language-plaintext highlighter-rouge">pandas</code> and take a look at how it can help you to slice
and dice tables in Python. Or should I say <code class="language-plaintext highlighter-rouge">DataFrame</code>s, because that‚Äôs
what <code class="language-plaintext highlighter-rouge">pandas</code> calls them, acknowledging inspiration from R‚Äôs trademark
data structure.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">"data/concordance_corpus.xlsx"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span>
</code></pre></div></div>

<!-- TODO: Whew, preview long and unwieldy, let's use the `.head()` method -->
<!-- from now on to condense it a little bit. -->

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="s">"data/concordance_corpus.xlsx"</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="bp">None</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="s">"data/concordance_corpus.xlsx"</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"domain"</span><span class="p">,</span> <span class="s">"left"</span><span class="p">,</span> <span class="s">"kwic"</span><span class="p">,</span> <span class="s">"right"</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[[</span><span class="s">"domain"</span><span class="p">,</span> <span class="s">"kwic"</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">"domain"</span><span class="p">:</span><span class="s">"kwic"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s">"domain"</span><span class="p">,</span> <span class="s">"kwic"</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">kwic</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="s">"newadvent.org"</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="s">"newadvent.org"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">"domain == 'newadvent.org'"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".org"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".org"</span><span class="p">)]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">kwic</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">kwic</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">break</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">kwic</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[[</span><span class="s">"kwic"</span><span class="p">,</span> <span class="s">"domain"</span><span class="p">]]</span>
</code></pre></div></div>

<p>```python tags=[‚Äúraises-exception‚Äù, ‚Äúfull_width‚Äù, ‚Äúoutput_scroll‚Äù]
df[[‚Äúword‚Äù, ‚Äúlemma‚Äù, ‚Äútag‚Äù]]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```python
df[["word", "lemma", "tag"]] = df.kwic.str.split("/", expand=True)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">"domain"</span><span class="p">,</span> <span class="s">"left"</span><span class="p">,</span> <span class="s">"word"</span><span class="p">,</span> <span class="s">"lemma"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">,</span> <span class="s">"right"</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"bar"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">"domain"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"bar"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"rank"</span><span class="p">,</span> <span class="s">"collocation"</span><span class="p">,</span> <span class="s">"freq"</span><span class="p">,</span> <span class="s">"empty"</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>If you want to go in the other direction and store <code class="language-plaintext highlighter-rouge">DataFrame</code>s on disk
as Excel spreadsheets, CSV files or many other formats, check out the
methods starting with <code class="language-plaintext highlighter-rouge">to_*</code> on <code class="language-plaintext highlighter-rouge">DataFrame</code> objects (remember you can
use <code class="language-plaintext highlighter-rouge">Tab</code> in JupyterLab to bring up a completion menu if you start
typing just <code class="language-plaintext highlighter-rouge">to_</code>).</p>

<p><code class="language-plaintext highlighter-rouge">pandas</code> is an impressively featureful library and we‚Äôve barely
scratched the surface of what you can do with it. It has also only
fairly recently hit 1.0 status, which means a lot of polish has been
applied to its website and documentation. Previously, the documentation,
though extensive and complete, was somewhat hard to navigate; this has
gotten much better. For more information, I suggest reviewing the
library‚Äôs <a href="https://pandas.pydata.org/docs/getting_started/index.html"><em>Getting
started</em></a>,
which contains a <a href="https://pandas.pydata.org/docs/getting_started/index.html#intro-to-pandas">list of practical
tasks</a>
you might want to use <code class="language-plaintext highlighter-rouge">pandas</code> for along with recipes telling you how to
achieve that.</p>

<h2 id="the-csv-module-in-the-standard-library">The <code class="language-plaintext highlighter-rouge">csv</code> module in the standard library</h2>

<p>The Python standard library also comes with a <a href="https://docs.python.org/3/library/csv.html"><code class="language-plaintext highlighter-rouge">csv</code>
module</a>. This is useful when
you don‚Äôt have the option to install <code class="language-plaintext highlighter-rouge">pandas</code>, or when you don‚Äôt really
need to work with the CSV file as a table, you just need to pull out
some values and put them in a dictionary for instance. In that case,
<code class="language-plaintext highlighter-rouge">pandas</code> may be an unnecessarily heavy dependency (as a Swiss Army knife
for data manipulation, it‚Äôs pretty hefty), not to mention that loading
the entire table into memory at once might be wasteful, especially if
it‚Äôs large and you just want one or two columns.</p>

<p>Let‚Äôs first take a peek at the contents of a CSV file. As mentioned,
it‚Äôs basically just a plain text file. This particular CSV file contains
a frequency distribution of <em>intensifier + adverb</em> combinations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">csv</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">row</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">";"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">int</span><span class="p">(</span><span class="s">"4"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">float</span><span class="p">(</span><span class="s">"4.5"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">adv</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</code></pre></div></div>

<p>Let‚Äôs divide up the adjectives into sets based on which intensifiers
they co-occur.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">completely</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">totally</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">entirely</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">utterly</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"data/frequencies_intensifiers.csv"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">";"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">adv</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">adv</span> <span class="o">==</span> <span class="s">"completely"</span><span class="p">:</span>
            <span class="n">completely</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">adv</span> <span class="o">==</span> <span class="s">"totally"</span><span class="p">:</span>
            <span class="n">totally</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">adv</span> <span class="o">==</span> <span class="s">"entirely"</span><span class="p">:</span>
            <span class="n">entirely</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">adv</span> <span class="o">==</span> <span class="s">"utterly"</span><span class="p">:</span>
            <span class="n">utterly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"unexpected adverb:"</span><span class="p">,</span> <span class="n">adv</span><span class="p">)</span>
</code></pre></div></div>

<p>By using set operations, we can now figure out which intensifiers tend
(not) to co-occur with which adjectives.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">not_utterly</span> <span class="o">=</span> <span class="n">completely</span> <span class="o">|</span> <span class="n">totally</span> <span class="o">|</span> <span class="n">entirely</span>
<span class="c1"># or: not_utterly = completely.union(totally).union(entirely)
</span></code></pre></div></div>

<p>```python tags=[‚Äúoutput_scroll‚Äù]
utterly - not_utterly</p>
<h1 id="or-utterlydifferencenot_utterly">or: utterly.difference(not_utterly)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# Storing objects on disk and reloading them

Some values take a long time to compute, so you don't want to have to
compute them again and again each time you close and reopen JupyterLab.
Instead, you'd like to compute them once, store them somewhere, and
reload them (almost) instantaneously whenever you need.

## The `%store` magic function

The `%store` magic function can store individual variables; it's perhaps
the simplest option, but you don't really control where the object gets
stored.

```python
a = 2
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">store</span> <span class="n">a</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">a</span>
</code></pre></div></div>

<p>Reload the stored value of the <code class="language-plaintext highlighter-rouge">a</code> variable:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">store</span> <span class="o">-</span><span class="n">r</span> <span class="n">a</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span>
</code></pre></div></div>

<p>For more information, consult <code class="language-plaintext highlighter-rouge">%store</code>‚Äôs docstring.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">?</span><span class="o">%</span><span class="n">store</span>
</code></pre></div></div>

<h2 id="the-json-standard-library-module">The <code class="language-plaintext highlighter-rouge">json</code> standard library module</h2>

<p>The standard library <a href="https://docs.python.org/3/library/json.html"><code class="language-plaintext highlighter-rouge">json</code>
module</a> can also be used
for this purpose.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
</code></pre></div></div>

<p>JSON <a href="https://en.wikipedia.org/wiki/Serialization">serialization</a>
actually results in plain text, which is nice and mostly human readable,
if it‚Äôs pretty-printed. It looks close to how the same data structure
is written down in Python (can you spot the differences?).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">person</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"John Doe"</span><span class="p">,</span>
    <span class="s">"age"</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
    <span class="s">"interests"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Python"</span><span class="p">,</span> <span class="s">"linguistics"</span><span class="p">],</span>
    <span class="s">"single"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">"pet"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>When writing to disk, you get to pick where the object is stored, at the
expense of having to type more than with <code class="language-plaintext highlighter-rouge">%store</code>. The <code class="language-plaintext highlighter-rouge">"w"</code> argument
sets the mode of the open file to <em>write</em> (the <code class="language-plaintext highlighter-rouge">"r"</code> mode for <em>reading</em>
is the default, so we didn‚Äôt need to set it explicitly before when
reading files).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"person.json"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">cat</span> <span class="n">person</span><span class="o">.</span><span class="n">json</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"person.json"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
<span class="n">data</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cleanup
</span><span class="o">%</span><span class="n">rm</span> <span class="n">person</span><span class="o">.</span><span class="n">json</span>
</code></pre></div></div>

<p>If you want to store multiple objects like this, just put them in a
dictionary and <code class="language-plaintext highlighter-rouge">json.dump</code> the whole thing.</p>

<p>JSON was created as an interchange format, which comes both with
advantages and a drawbacks. The advantage is it can be easily loaded
into different languages / tools, almost every programming language now
has an easily accessible JSON library. The main drawback is that it only
works for storing a limited range of types: dicts, lists, strings,
numbers, Boolean values (<code class="language-plaintext highlighter-rouge">True</code> and <code class="language-plaintext highlighter-rouge">False</code>) and <code class="language-plaintext highlighter-rouge">None</code>. As an
interchange format, it makes sense that it has to stick to the lowest
common denominator of what‚Äôs available in some form in almost every
programming language, otherwise there couldn‚Äôt be much interchange.
Some additional types can be stored as JSON, but only by being converted
to one of the above ‚Äì e.g. if you store a tuple in JSON and load it
back, it will become a list.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</code></pre></div></div>

<h2 id="the-pickle-standard-library-module">The <code class="language-plaintext highlighter-rouge">pickle</code> standard library module</h2>

<p><a href="https://docs.python.org/3/library/pickle.html">Pickling objects</a> works
in a very similar way to dumping them as JSON, just make sure to open
the file for writing <strong>in binary mode</strong> (<code class="language-plaintext highlighter-rouge">"wb"</code>):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"person.pickle"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
</code></pre></div></div>

<p>‚Ä¶ and for reading as well (<code class="language-plaintext highlighter-rouge">"rb"</code>):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"person.pickle"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
<span class="n">data</span>
</code></pre></div></div>

<p>This is because pickling doesn‚Äôt use a plain text format, but a custom
binary format.</p>

<p>```python tags=[‚Äúoutput_scroll‚Äù]
%cat person.pickle</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```python
# cleanup
%rm person.pickle
</code></pre></div></div>

<p>The advantage of <code class="language-plaintext highlighter-rouge">pickle</code> is that unlike JSON, it can faithfully
preserve a much wider spectrum of Python objects (most things you‚Äôre
likely to need in normal practice). This flexibility is partially
achieved by allowing arbitrary code to run during unpickling, based on
what‚Äôs stored in the pickle, which is a security flaw ‚Äì someone could
in theory send you a maliciously crafted pickle which deletes your home
directory upon unpickling. <strong>So only unpickle data from sources you
trust.</strong></p>

<p>Another disadvantage is that the format is specific to Python, and it
can even change between versions of the language: there are <a href="https://docs.python.org/3/library/pickle.html#data-stream-format">several
versions of the pickle
protocol</a>,
as it gets improved over time. This means that if you want to share
pickled objects across Python versions, you need to be careful about
which protocol version you use in order to retain backwards
compatibility.</p>

<p>Like with JSON, if you want to pickle multiple objects, you still have
to store them separately, or put them all in a dict manually and store
the dict.</p>

<h2 id="the-dill-library">The <code class="language-plaintext highlighter-rouge">dill</code> library</h2>

<p><a href="https://dill.readthedocs.io"><code class="language-plaintext highlighter-rouge">dill</code></a> is <code class="language-plaintext highlighter-rouge">pickle</code> on steroids. For any
less proficient English speakers reading and/or those without a
background in English literature, the name is a pun on <a href="https://www.google.com/search?client=q=dill+pickle">dill
pickle</a>, or maybe
even <a href="https://en.wikipedia.org/wiki/A_Dill_Pickle"><em>A Dill Pickle</em></a>.
Its biggest advantage is that it can pickle entire sessions (kind of
like R does, if you‚Äôre familiar with R), you don‚Äôt have to specify
objects one by one. Before we demonstrate this though, we‚Äôll need to get
rid of our CSV <code class="language-plaintext highlighter-rouge">reader</code> object from before, because it turns out that‚Äôs
one of the objects which can‚Äôt be even dill-pickled. (You don‚Äôt have to
remember this by heart, I certainly don‚Äôt ‚Äì Python will complain loudly
if you try to pickle something that can‚Äôt be pickled.)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dill</span>

<span class="k">del</span> <span class="n">reader</span>
<span class="n">dill</span><span class="o">.</span><span class="n">dump_session</span><span class="p">(</span><span class="s">"session.pickle"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dill</span><span class="o">.</span><span class="n">load_session</span><span class="p">(</span><span class="s">"session.pickle"</span><span class="p">)</span>
<span class="c1"># cleanup
</span><span class="o">%</span><span class="n">rm</span> <span class="n">session</span><span class="o">.</span><span class="n">pickle</span>
</code></pre></div></div>

<p>Apart from the advantages of being able to pickle entire sessions,
<code class="language-plaintext highlighter-rouge">dill</code> also extends pickling support to more types of objects. You can
just switch your code to using <code class="language-plaintext highlighter-rouge">dill.dump()</code> / <code class="language-plaintext highlighter-rouge">dill.load()</code> instead of
<code class="language-plaintext highlighter-rouge">pickle.dump()</code> / <code class="language-plaintext highlighter-rouge">pickle.load()</code> and you get this extended support for
free.</p>

<p>The disadvantages are the same as for <code class="language-plaintext highlighter-rouge">pickle</code>, plus it‚Äôs not bundled
with Python, so it‚Äôs another dependency you have to <a href="https://pypi.org/project/dill/">install it
separately</a>.</p>

            </div>
            <div class="c-textbook__footer" id="textbook_footer">
              
<nav class="c-page__nav">
  

  
</nav>

              <footer>
  <p class="footer">Sponsored by <a href="https://www.visegradfund.org/">Visegrad Fund</a> grant nr. 21820079 "Training Digital Scholars: Knowledge Exchange between V4 and Austria". Available under the terms of the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> license.</p>
</footer>

            </div>

        </div>
      </main>
    </div>
  </body>
</html>
